<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="ChatApp.Client.Views.ChatPage"
             Title="Chat Publiczny"
             BackgroundColor="#1a1a2e">

    <Grid RowDefinitions="Auto,*,Auto" Padding="0" RowSpacing="0">

        <!-- Nagłówek -->
        <StackLayout Grid.Row="0" 
                     Padding="16,12" 
                     BackgroundColor="#16213e"
                     Spacing="4">

            <Label Text="💬 Chat Publiczny" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   TextColor="#ffb703"/>
            <Label Text="{Binding StatusMessage}" 
                   FontSize="12" 
                   TextColor="#888888"/>

            <!-- Przycisk Połącz (tylko gdy nie połączony) -->
            <Button IsVisible="{Binding IsConnected, Converter={StaticResource InvertedBoolConverter}}"
                    Command="{Binding ConnectCommand}"
                    Padding="12,8"
                    FontAttributes="Bold"
                    FontSize="12"
                    Text="🔗 Wpisz nick i się połącz"
                    BackgroundColor="#ffb703"
                    TextColor="#1a1a2e"
                    Margin="0,8,0,0"/>
        </StackLayout>

        <!-- Lista Wiadomości -->
        <ScrollView Grid.Row="1" BackgroundColor="#1a1a2e">
            <StackLayout Padding="12,12,12,0" Spacing="8" BindableLayout.ItemsSource="{Binding Messages}">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <Frame CornerRadius="12"
                               Padding="12,10"
                               HasShadow="False"
                               BackgroundColor="#ffffff">

                            <!-- Żółta dla "Patryk", biała dla innych -->
                            <Frame.Triggers>
                                <DataTrigger TargetType="Frame" 
                                             Binding="{Binding NickName}" 
                                             Value="Patryk">
                                    <Setter Property="BackgroundColor" Value="#ffb703" />
                                </DataTrigger>
                            </Frame.Triggers>

                            <StackLayout Spacing="4">
                                <Label Text="{Binding NickName}" 
                                       FontSize="11" 
                                       FontAttributes="Bold"
                                       TextColor="#666666"/>
                                <Label Text="{Binding Content}" 
                                       FontSize="14"
                                       TextColor="#1a1a2e"
                                       LineBreakMode="WordWrap"/>
                                <Label Text="{Binding Timestamp, StringFormat='{0:HH:mm}'}"
                                       FontSize="10"
                                       TextColor="#999999"/>
                            </StackLayout>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </StackLayout>
        </ScrollView>

        <!-- Input do wiadomości -->
        <StackLayout Grid.Row="2" 
                     Padding="12"
                     Spacing="8"
                     BackgroundColor="#16213e">

            <!-- Input nicku (widoczny tylko gdy nie połączony) -->
            <StackLayout IsVisible="{Binding IsConnected, Converter={StaticResource InvertedBoolConverter}}"
                         Spacing="6">
                <Label Text="Nick:" FontSize="12" TextColor="#ffb703" FontAttributes="Bold"/>
                <Entry Placeholder="Wpisz nick..."
                       Text="{Binding NickName}"
                       BackgroundColor="#0f3460"
                       TextColor="#ffffff"
                       FontSize="14"/>
            </StackLayout>

            <!-- Input wiadomości -->
            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                <Entry Grid.Column="0"
                       Placeholder="Napisz wiadomość..."
                       Text="{Binding MessageText}"
                       IsEnabled="{Binding IsConnected}"
                       BackgroundColor="#0f3460"
                       TextColor="#ffffff"
                       FontSize="14"/>

                <Button Grid.Column="1"
                        Text="➤"
                        Command="{Binding SendMessageCommand}"
                        IsEnabled="{Binding IsConnected}"
                        BackgroundColor="#ffb703"
                        TextColor="#1a1a2e"
                        Padding="12"
                        FontSize="16"
                        FontAttributes="Bold"
                        WidthRequest="50"/>
            </Grid>
        </StackLayout>

    </Grid>

</ContentPage>
